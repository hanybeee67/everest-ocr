<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>μ—λ² λ μ¤νΈ κ΄€λ¦¬μ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
<div class="page-wrapper">

    <h1 class="page-title">κ΄€λ¦¬μ λ€μ‹λ³΄λ“</h1>
    <p class="page-subtitle">ν„μ¬ μ—λ² λ μ¤νΈ λ©¤λ²„μ‹­μ ν„ν™©μ„ ν•λμ— ν™•μΈν•μ„Έμ”.</p>

    <div class="stats-container">
        <div class="stat-card">
            <h3>μ „μ²΄ νμ› μ</h3>
            <div class="value">{{ total_members }}λ…</div>
        </div>
        <div class="stat-card">
            <h3>μ¤λ κ°€μ…μ</h3>
            <div class="value" style="color: #ff7f3f;">{{ today_members }}λ…</div>
        </div>
        <div class="stat-card">
            <h3>μµλ‹¤ λ°©λ¬Έ μ§€μ </h3>
            <div class="value" style="font-size: 20px;">
                {% if top_branch_name %}{{ top_branch_name }}{% else %}-{% endif %}
            </div>
        </div>
        <div class="stat-card">
            <h3>λ„μ  λ°©λ¬Έ μ</h3>
            <div class="value">{{ total_visits }}ν</div>
        </div>
    </div>


    <div style="display: flex; justify-content: space-between; align-items: end; margin-bottom: 10px; margin-top: 40px;">
        <h2 class="page-title" style="margin: 0; border: none; padding: 0; font-size: 22px;">π“‹ νμ› λ©λ΅</h2>
        
        <div class="toolbar" style="margin: 0;">
            <form method="get" class="sort-area" style="display: flex; align-items: center;">
                <select name="sort" class="admin-select">
                    <option value="date"   {% if sort=='date'   %}selected{% endif %}>κ°€μ…μΌμ</option>
                    <option value="name"   {% if sort=='name'   %}selected{% endif %}>μ΄λ¦„μ</option>
                    <option value="branch" {% if sort=='branch' %}selected{% endif %}>μ§€μ μ</option>
                    <option value="visit"  {% if sort=='visit'  %}selected{% endif %}>λ°©λ¬Ένμμ</option>
                </select>
                <button class="btn small-btn">λ³΄κΈ°</button>
            </form>
            <button class="print-btn">μΈμ‡„</button>
        </div>
    </div>

    <div class="table-wrapper">
        <table class="member-table">
            <colgroup>
                <col style="width: 15%;"> <col style="width: 25%;"> <col style="width: 20%;"> <col style="width: 15%;"> <col style="width: 25%;"> </colgroup>
            <thead>
                <tr>
                    <th>μ΄λ¦„</th>
                    <th>μ „ν™”λ²νΈ</th>
                    <th>κ°€μ… μ§€μ </th>
                    <th>λ°©λ¬Ένμ</th>
                    <th>κ°€μ…μΌ</th>
                </tr>
            </thead>
            <tbody>
            {% for m in members %}
                <tr>
                    <td style="font-weight: 500;">{{ m.name }}</td>
                    <td>{{ m.phone }}</td>
                    <td>{{ m.branch }}</td>
                    <td><span style="background: #eee; padding: 4px 10px; border-radius: 10px; font-weight: bold; font-size: 12px;">{{ m.visit_count }}ν</span></td>
                    <td>{{ m.created_at }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    <h2 class="page-title" style="margin-top: 50px; font-size: 22px; border: none; padding: 0;">π§Ύ μμμ¦ λ“±λ΅ κΈ°λ΅ ({{ all_receipts|length }}κ±΄)</h2>

    <div class="table-wrapper">
        <table class="member-table">
            <colgroup>
                <col style="width: 20%;"> <col style="width: 15%;"> <col style="width: 15%;"> <col style="width: 20%;"> <col style="width: 20%;"> <col style="width: 10%;"> </colgroup>
            <thead>
                <tr>
                    <th>λ“±λ΅μΌμ‹</th>
                    <th>νμ›λ…</th>
                    <th>κ²°μ  μ§€μ </th>
                    <th>κΈμ•΅</th>
                    <th>μΉμΈλ²νΈ</th>
                    <th>μƒνƒ</th>
                </tr>
            </thead>
            <tbody>
            {% for r in all_receipts %}
                <tr>
                    <td>{{ r.visit_date.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td style="font-weight: 500;">{{ r.member.name }}</td>
                    <td>{{ r.branch_paid }}</td>
                    <td style="color: #333; font-weight: 600;">{{ "{:,}".format(r.amount) }}μ›</td>
                    <td style="color: #666; font-size: 13px;">{{ r.receipt_no }}</td>
                    <td>
                        {% if r.is_coupon_used %}
                            <span style="color: #28a745; font-weight: 700;">μΏ ν°λ°κΈ‰</span>
                        {% else %}
                            <span style="color: #aaa;">-</span>
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" style="padding: 30px; color: #999;">μ•„μ§ λ“±λ΅λ μμμ¦μ΄ μ—†μµλ‹λ‹¤.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script>
document.querySelector(".print-btn").onclick = () => window.print();
</script>

</body>
</html>